/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package view;

import controller.AkunController;
import controller.BukuController;
import controller.PenulisController;
import controller.PenulisBukuController;
import controller.TransaksiBukuController;
import java.sql.Connection;

/**
 *
 * @author Dayinta Warih Wulandari
 */
public class MemberView extends javax.swing.JInternalFrame {

    private final PenulisBukuController pbc;
    private final TransaksiBukuController tbc;
    private final String[] headerDetailBuku = {"ID Buku", "ID Penulis", "Judul", "Penulis", "Status"};
    private final String[] headerTransBuku = {"ID Transaksi", "ID Akun", "Nama", "Judul", "Tgl Pinjam", "Tgl Kembali", "Status", "Terlambat", "Denda"};
    private final String[] categoriesDetailBuku;
    private final String[] categoriesTransBuku;
    private final ViewProccess viewProccess;
    int stat;

    /**
     * Creates new form MemberView
     */
    public MemberView(Connection connection) {
        initComponents();
        this.categoriesDetailBuku = new String[]{"buku_id", "penulis_id", "judul", "penulis", "status"};
        this.categoriesTransBuku = new String[]{"transaksi_id", "id", "nama", "judul", "Tgl tanggal_pinjam", "tanggal_kembali", "status", "terlambat", "denda"};
        this.tbc = new TransaksiBukuController(connection);
        this.pbc = new PenulisBukuController(connection);
        this.viewProccess = new ViewProccess();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jScrollPane1 = new javax.swing.JScrollPane();
        tblMember = new javax.swing.JTable();
        cmbCategory = new javax.swing.JComboBox<String>();
        btnFind = new javax.swing.JButton();
        btnTransaksiBuku = new javax.swing.JButton();
        btnDetailBuku = new javax.swing.JButton();
        txtSearch = new javax.swing.JTextField();

        setClosable(true);
        setIconifiable(true);
        setMaximizable(true);

        tblMember.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {},
                {},
                {},
                {}
            },
            new String [] {

            }
        ));
        jScrollPane1.setViewportView(tblMember);

        cmbCategory.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmbCategoryActionPerformed(evt);
            }
        });

        btnFind.setText("Cari");

        btnTransaksiBuku.setText("Transaksi Buku");
        btnTransaksiBuku.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnTransaksiBukuActionPerformed(evt);
            }
        });

        btnDetailBuku.setText(" Buku");
        btnDetailBuku.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnDetailBukuActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 445, Short.MAX_VALUE)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(cmbCategory, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txtSearch)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btnFind))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(btnDetailBuku)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(btnTransaksiBuku)))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(cmbCategory, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnFind)
                    .addComponent(txtSearch, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 157, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnDetailBuku, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(btnTransaksiBuku, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGap(36, 36, 36))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnDetailBukuActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDetailBukuActionPerformed
        stat = 1;
        loadSearchComboBoxBuku();
        bindingTableDetailBuku();
    }//GEN-LAST:event_btnDetailBukuActionPerformed

    private void btnTransaksiBukuActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTransaksiBukuActionPerformed
        stat = 2;
        loadSearchComboBoxTransaksi();
        bindingTableTransBuku();
    }//GEN-LAST:event_btnTransaksiBukuActionPerformed

    private void cmbCategoryActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmbCategoryActionPerformed
        if (stat == 1){
           this.searchTableBuku(this.viewProccess.getCategory(this.categoriesDetailBuku, cmbCategory), txtSearch.getText()); 
        }
        else if (stat ==2){
            this.searchTableTransaksi(this.viewProccess.getCategory(this.categoriesTransBuku, cmbCategory), txtSearch.getText()); 
        } else
        resetCombo();
    }//GEN-LAST:event_cmbCategoryActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnDetailBuku;
    private javax.swing.JButton btnFind;
    private javax.swing.JButton btnTransaksiBuku;
    private javax.swing.JComboBox<String> cmbCategory;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTable tblMember;
    private javax.swing.JTextField txtSearch;
    // End of variables declaration//GEN-END:variables

    public void bindingTableDetailBuku() {
        this.viewProccess.loadData(this, tblMember, headerDetailBuku,
                this.pbc.bindingSort(categoriesDetailBuku[0], "asc"));
    }

    public void bindingTableTransBuku() {
        this.viewProccess.loadData(this, tblMember, headerTransBuku,
                this.tbc.bindingSort(categoriesTransBuku[0], "asc"));
    }
    
    public void searchTableBuku(String category, String data) {
        this.viewProccess.loadData(this, tblMember, headerDetailBuku,
                this.pbc.find(category, data));
    }

    public void loadSearchComboBoxBuku() {
        this.viewProccess.loadSearchComboBox(cmbCategory, headerDetailBuku);
    }
    
        public void searchTableTransaksi(String category, String data) {
        this.viewProccess.loadData(this, tblMember, headerTransBuku,
                this.tbc.find(category, data));
    }

    public void loadSearchComboBoxTransaksi() {
        this.viewProccess.loadSearchComboBox(cmbCategory, headerTransBuku);
    }
    
    public void resetCombo(){
        cmbCategory.removeAllItems();
        stat = 0;
    }
}
